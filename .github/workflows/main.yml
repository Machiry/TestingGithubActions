# This is a basic workflow to help you get started with Actions

name: Nightly Sanity Tests

# Controls when the action will run. Triggers the workflow on push or pull request
# events but only for the master branch
on: push


env:
  builddir: "b/ninja"
  vsftpddir: "vsftpd_testing"
  vsftpdurl: "https://security.appspot.com/downloads/vsftpd-3.0.3.tar.gz"

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  # Next we build
  build:
    name: Build cconv-standalone and clang
    # The type of OS that the job will run on
    runs-on: ubuntu-latest
    # Steps represent a sequence of tasks that will be executed as part of the job
    steps:
      # Install all the required dependencies
      - name: Install dependencies
        run: |
          sudo apt-get update
          sudo apt-get install gcc-8 g++-8 git python cmake wget tar ninja-build liblzma-dev libreadline-dev
      # clone and install bear
      # Needed for generating compile_commands.json
      - name: Clone Bear
        uses: actions/checkout@v2
        with:
          repository: rizsotto/Bear
          path: depsfolder/bear
      - run: |
          cd ${{github.workspace}}/depsfolder/bear
          git pull
          git checkout -f 75ff7f561652509ec9b34095881fdb6c4a56c9e0    
      - name: Install Bear
        run: |
          mkdir -p ${{runner.workspace}}/depsfolder/bear
          cd ${{runner.workspace}}/depsfolder/bear
          cmake ${{github.workspace}}/depsfolder/bear
          make all
          sudo make install
